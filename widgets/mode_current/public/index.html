<!doctype html>
<html>
<head lang="en">
    <title>Current mode</title>

    <link
        rel="stylesheet"
        href="style.css">
</head>

<body class="homey-widget">

<div class="current-mode">
    <div
        class="current-mode-icon"
        id="current-mode-icon"></div>

    <div class="current-mode-caption">
        <div
            class="current-mode-label homey-text-small-light"
            data-i18n="widget.current_mode.label"></div>
        <div
            class="current-mode-name homey-text-bold"
            id="current-mode-name">
            &mdash;
        </div>
    </div>
</div>

<script type="text/javascript">
    function onHomeyReady(Homey) {
        const currentModeIcon = document.getElementById('current-mode-icon');
        const currentModeName = document.getElementById('current-mode-name');
        let ready = false;

        async function init() {
            Homey.on('flowbits-mode-update', update);

            await update();
        }

        async function update() {
            const currentMode = await Homey.api('GET', '/');

            currentModeName.innerText = currentMode?.name ?? 'â€”';

            if (currentMode?.icon) {
                currentModeIcon.style.setProperty('--color', currentMode.icon.color);
                currentModeIcon.style.setProperty('--icon', currentMode.icon.unicode);
                currentModeIcon.style.setProperty('--icon-secondary', currentMode.icon.unicodeSecondary);
            } else {
                currentModeIcon.style.removeProperty('--color');
                currentModeIcon.style.removeProperty('--icon');
                currentModeIcon.style.removeProperty('--icon-secondary');
            }

            const height = document.body.getBoundingClientRect().height;

            if (ready) {
                await Homey.setHeight(height);
            } else {
                Homey.ready({height});
                ready = true;
            }
        }

        init();
    }
</script>

</body>
</html>
